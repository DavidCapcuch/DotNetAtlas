using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

namespace DotNetAtlas.Infrastructure.Persistence.Database.Migrations;

/// <inheritdoc />
public partial class CreateOutboxMessagesTable : Migration
{
    /// <inheritdoc />
    protected override void Up(MigrationBuilder migrationBuilder)
    {
        migrationBuilder.CreateTable(
            name: "OutboxMessages",
            schema: "weather",
            columns: table => new
            {
                Id = table.Column<long>(type: "bigint", nullable: false, comment: "PK, Identity")
                    .Annotation("SqlServer:Identity", "1, 1"),
                KafkaKey = table.Column<string>(type: "nvarchar(128)", maxLength: 128, nullable: true, comment: "Kafka Key - typically the Aggregate ID for proper event ordering and partitioning"),
                AvroPayload = table.Column<byte[]>(type: "varbinary(max)", nullable: false, comment: "Avro-serialized domain event payload"),
                Type = table.Column<string>(type: "varchar(255)", unicode: false, maxLength: 255, nullable: false, comment: "Avro type name of the serialized event (e.g., 'FeedbackChangedEvent') used for type-based topic routing"),
                Headers = table.Column<string>(type: "nvarchar(max)", maxLength: 8192, nullable: true, comment: "JSON dictionary of OpenTelemetry-standard headers for distributed tracing and metadata. Headers are automatically generated by OpenTelemetry propagators for end-to-end trace context propagation."),
                CreatedUtc = table.Column<DateTimeOffset>(type: "datetimeoffset", nullable: false, comment: "Creation timestamp (UTC).")
            },
            constraints: table =>
            {
                table.PrimaryKey("PK_OutboxMessages", x => x.Id);
            },
            comment: "Outbox pattern table for storing domain events as Avro-serialized messages for reliable event publishing.");
    }

    /// <inheritdoc />
    protected override void Down(MigrationBuilder migrationBuilder)
    {
        migrationBuilder.DropTable(
            name: "OutboxMessages",
            schema: "weather");
    }
}
